<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CodeGenApp.MainPage"
             Title="CodeGenAdv - API Template Builder">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label x:Name="RootPathLabel"
                   Text="Root: (not set)"
                   FontSize="12"
                   TextColor="Gray" />

            <BoxView HeightRequest="1" Color="LightGray" Margin="0,6" />

            <Label Text="API-Only Template Builder (Attach Lambdas by ARN)"
                   FontAttributes="Bold"
                   FontSize="16" />

            <!-- API meta -->
            <Label Text="API Name (for display)" />
            <Entry x:Name="ApiNameEntry"
                   Placeholder="e.g. AlbaGold-MultiTable-API" />

            <Label Text="Stage Name" />
            <Entry x:Name="StageNameEntry"
                   Placeholder="e.g. prod" />

            <BoxView HeightRequest="1" Color="LightGray" Margin="0,6" />

            <!-- SIMPLE: Command Generator -->
            <Label Text="AWS / SAM Commands (Copy-Paste Helper)"
                   FontAttributes="Bold"
                   FontSize="14" />

            <Label Text="AWS Region (optional)" FontSize="12" />
            <Entry x:Name="AwsRegionEntry"
                   Placeholder="us-east-2 (optional)" />

            <Label Text="CloudFormation Stack Name" FontSize="12" />
            <Entry x:Name="StackNameEntry"
                   Placeholder="e.g. alba-pack1-stack" />

            <Label Text="Lambda Function Name (optional; used for ARN command)" FontSize="12" />
            <Entry x:Name="LambdaNameEntry"
                   Placeholder="e.g. MyFunction-ABC123" />

            <HorizontalStackLayout Spacing="10">
                <Button Text="Copy: Stack Outputs JSON command"
                        Clicked="OnCopyDescribeOutputsCommandClicked" />
                <Button Text="Copy: List Lambda names command"
                        Clicked="OnCopyListLambdasCommandClicked" />
            </HorizontalStackLayout>

            <HorizontalStackLayout Spacing="10">
                <Button Text="Copy: Get Lambda ARN command"
                        Clicked="OnCopyGetLambdaArnCommandClicked" />
                <Button Text="Copy: sam build/deploy commands"
                        Clicked="OnCopySamCommandsClicked" />
            </HorizontalStackLayout>

            <Editor x:Name="CommandsEditor"
                    Text="Commands will appear here when you click a Copy button."
                    IsReadOnly="True"
                    AutoSize="TextChanges"
                    HeightRequest="140"
                    Margin="0,6,0,0" />

            <Label Text="Tip: paste commands into Terminal. If region is blank, your AWS CLI default region is used."
                   FontSize="10"
                   TextColor="Gray" />

            <BoxView HeightRequest="1" Color="LightGray" Margin="0,6" />

            <!-- Authorizer -->
            <Label Text="Authorizer Lambda ARN (required)" />
            <Entry x:Name="AuthorizerArnEntry"
                   Placeholder="arn:aws:lambda:us-east-2:123456789012:function:YourAuthorizerFunction" />

            <Label Text="Note: You can copy Outputs JSON using the button above, then paste into Pack #1."
                   FontSize="10"
                   TextColor="Gray" />

            <BoxView HeightRequest="1" Color="LightGray" Margin="0,6" />

            <!-- Packs controls -->
            <HorizontalStackLayout Spacing="10">
                <Button Text="Add Pack" Clicked="OnAddPackClicked" />
                <Button Text="Remove Last Pack" Clicked="OnRemovePackClicked" />
            </HorizontalStackLayout>

            <Label Text="Each Pack = One Table's Lambda Stack Outputs JSON"
                   FontSize="10"
                   TextColor="Gray" />

            <!-- Packs list -->
            <CollectionView x:Name="PacksCollectionView"
                            ItemsSource="{Binding Packs}"
                            Margin="0,6,0,0">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="12" Margin="0,6" BorderColor="LightGray">
                            <VerticalStackLayout Spacing="8">

                                <Label Text="{Binding Title}"
                                       FontAttributes="Bold" />

                                <Label Text="Base Path (API route prefix for this pack)"
                                       FontSize="12" />
                                <Entry Text="{Binding BasePath}"
                                       Placeholder="e.g. /cgadv or /vendors" />

                                <Label Text="CloudFormation Outputs JSON (paste array from CLI)"
                                       FontSize="12" />
                                <Editor Text="{Binding OutputsJson}"
                                        AutoSize="TextChanges"
                                        HeightRequest="160"
                                        Placeholder='Paste this JSON:
[
  { "OutputKey": "XCreateArn", "OutputValue": "arn:..." },
  ...
]' />

                                <Label Text="Expected OutputKeys end with:
CreateArn, GetListArn, GetOneArn, UpdateDeleteArn, DeletePermanentArn
(and optionally AuthorizerArn)"
                                       FontSize="10"
                                       TextColor="Gray" />

                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <BoxView HeightRequest="1" Color="LightGray" Margin="0,10,0,0" />

            <Button Text="Generate API-Only SAM Template (template-api.yaml)"
                    Margin="0,5,0,0"
                    Clicked="OnGenerateApiTemplateClicked" />

            <Editor x:Name="StatusEditor"
                    Text="Ready."
                    TextColor="Green"
                    IsReadOnly="True"
                    AutoSize="TextChanges"
                    Margin="0,15,0,0" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
